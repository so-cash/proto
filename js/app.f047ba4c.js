(function(){var t={81771:function(t,e,a){"use strict";a.d(e,{Z:function(){return u}});var s=function(){var t=this,e=t._self._c;return e("img",{ref:"container"})},n=[],r=a(50586);function i(t){t||(t="0x");const e=(0,r.create)({seed:t.toLowerCase(),bgcolor:"#fff",size:16,scale:4,spotcolor:"#000"});return e}var o={props:{value:void 0},mounted(){this.setCanvas(this.value)},computed:{address(){return this.value}},watch:{address(t){this.setCanvas(t)}},methods:{setCanvas(t){let e=this.$refs.container;e&&(e.src=i(t).toDataURL())}}},c=o,l=a(1001),d=(0,l.Z)(c,s,n,!1,null,null,null),u=d.exports},68201:function(t,e,a){"use strict";a.r(e),a.d(e,{default:function(){return u}});var s=function(){var t=this,e=t._self._c;return e("div")},n=[],r=a(90408),i=a(7160),o={props:{value:Boolean},async mounted(){await this.checkAndReceiveAddress()},data(){return{}},watch:{value(t,e){t&&!e&&this.forwardToCustodyUi()}},methods:{...(0,r.nv)(["goToPage","applyCurrentWalletAddress"]),async forwardToCustodyUi(){const t=this.$store.getters.variables;if(!t.walletCustodyUI)return;const e=new URL(t.walletCustodyUI);e.searchParams.append("action","select"),e.searchParams.append("redirect_uri",window.location.href),window.location.assign(e.href)},async checkAndReceiveAddress(){const t=new URL(window.location);if(t.searchParams.has("address"))await this.applyCurrentWalletAddress(t.searchParams.get("address")),(0,i.bz)(t.searchParams.get("address")),t.searchParams.delete("address"),window.history.replaceState(null,"",t.href);else{const t=await(0,i.gX)();t&&await this.applyCurrentWalletAddress(t)}}}},c=o,l=a(1001),d=(0,l.Z)(c,s,n,!1,null,null,null),u=d.exports},7160:function(t,e,a){"use strict";a.d(e,{bz:function(){return w},ZP:function(){return A},gX:function(){return g}});var s=function(){var t=this,e=t._self._c;return e("v-container",[e("v-overlay",{attrs:{value:t.transactionInProgress}},[e("v-progress-circular",{attrs:{indeterminate:"",size:"64"}})],1),e("v-layout",{attrs:{row:"",wrap:""}},[e("custody-selection",{attrs:{name:"in-page",value:t.activateWalletSelection}}),e("v-row",[t._l(t.visitedWalletsDetails,(function(a){return e("v-col",{key:a.address,attrs:{cols:"12"}},[e("v-card",{staticClass:"pa-3",attrs:{outlined:"",elevation:"3"},on:{click:function(e){return t.selectThisWallet(a.address)}}},[e("v-row",[e("v-col",{attrs:{cols:"1","align-self":"center"}},[e("eth-avatar-icon",{attrs:{value:a.address}})],1),e("v-col",{attrs:{cols:"6","align-self":"center"}},[t._v(" "+t._s(a.address)+" ")]),e("v-col",{attrs:{cols:"5","align-self":"center"}},[t._v(" "+t._s(a.balance/10**9)+" GWei ")])],1)],1)],1)})),e("v-col",{attrs:{cols:"12"}},[e("v-card",{staticClass:"pa-3",attrs:{outlined:"",elevation:"3"}},[e("v-btn",{attrs:{color:"secondary"},on:{click:function(e){t.activateWalletSelection=!0}}},[t._v("Visit the custody service to get a new wallet")])],1)],1),t.currentAddress?e("v-col",{attrs:{cols:"12"}},[e("v-card",{staticClass:"pa-3",attrs:{outlined:"",elevation:"3"}},[e("v-card-subtitle",[t._v("Crypto transfer - for convenience only")]),e("v-row",[e("v-col",{attrs:{cols:"5","align-self":"center"}},[e("v-text-field",{attrs:{label:"amount of GWei",type:"number"},model:{value:t.cryptoGWeiAmount,callback:function(e){t.cryptoGWeiAmount=e},expression:"cryptoGWeiAmount"}})],1),e("v-col",{attrs:{cols:"6","align-self":"center"}},[e("v-text-field",{attrs:{label:"target account address",type:"text"},model:{value:t.cryptoTransferTarget,callback:function(e){t.cryptoTransferTarget=e},expression:"cryptoTransferTarget"}})],1),e("v-col",{attrs:{cols:"1","align-self":"center"}},[e("v-btn",{on:{click:t.executeCryptoTransfer}},[t._v("Ok")])],1)],1)],1)],1):t._e()],2)],1)],1)},n=[],r=(a(57658),a(30541),a(90408)),i=a(98601),o=(a(58420),a(44423));const c=Math.pow(10,9),l=Math.pow(10,18);function d(t){return new o.O(t)}function u(t,e){const a=d(t);return"ether"===e?a.multipliedBy(l):"gwei"===e?a.multipliedBy(c):a}var h=a(82766),v=a(81771),f=a(68587);const p=i.wp.walletAddresses;var m={components:{EthAvatarIcon:v.Z,CustodySelection:()=>Promise.resolve().then(a.bind(a,68201))},data(){return{transactionInProgress:!1,visitedWallets:[],visitedWalletsDetails:[],activateWalletSelection:!1,cryptoGWeiAmount:void 0,cryptoTransferTarget:void 0}},async mounted(){this.visitedWallets=await(0,i.tO)().getItem(p)||[],await this.fillWalletDetails()},computed:{currentAddress(){return this.$store.getters.currentWalletAddress}},methods:{...(0,r.nv)(["applyCurrentWalletAddress"]),async fillWalletDetails(){const t=(0,i.tH)(),e=[];for(const a of this.visitedWallets){const s={address:a};s.balance=await t.getBalance(a),e.push(s)}this.visitedWalletsDetails=e},async selectThisWallet(t){await w(t),await this.applyCurrentWalletAddress(t)},async executeCryptoTransfer(){!this.cryptoGWeiAmount||this.cryptoGWeiAmount<=0||this.cryptoTransferTarget&&await(0,i.v1)(this,"transactionInProgress",(async()=>{const t=(0,i.bi)(this.currentAddress,h.up),e=u(this.cryptoGWeiAmount,"gwei");await f.Crypto.transfer(t.send({maxGas:3e4,amount:"0x"+e.toString(16)}),this.cryptoTransferTarget),(0,h.t5)(`Transfer of ${this.cryptoGWeiAmount} GWei to ${this.cryptoTransferTarget} completed.`),await this.fillWalletDetails(),this.cryptoGWeiAmount=void 0,this.cryptoTransferTarget=void 0}))}}};async function w(t){let e=await(0,i.tO)().getItem(p)||[];e=e.filter((e=>e!==t)),e.unshift(t),await(0,i.tO)().setItem(p,e)}async function g(){const t=await(0,i.tO)().getItem(p)||[];return t&&Array.isArray(t)&&t.length>0?t[0]:void 0}var b=m,y=a(1001),k=(0,y.Z)(b,s,n,!1,null,null,null),A=k.exports},98601:function(t,e,a){"use strict";a.d(e,{U6:function(){return S},nY:function(){return W},mm:function(){return E},bi:function(){return T},v1:function(){return F},tH:function(){return B},Y2:function(){return I},Yz:function(){return P},M8:function(){return v},tO:function(){return m},wp:function(){return f},NC:function(){return O}});var s=a(21688),n=(a(68587),a(87593),a(15438)),r=a(20587),i=a.n(r),o=a(95567),c=a.n(o);a(57658);class l{constructor(t){this.keyList=t||[]}async getItem(t){if(!t)return;this.keyList.includes(t)||this.keyList.push(t);const e=window.localStorage.getItem(t);return e?JSON.parse(e):void 0}async setItem(t,e){t&&(this.keyList.includes(t)||this.keyList.push(t),e?window.localStorage.setItem(t,JSON.stringify(e)):window.localStorage.removeItem(t))}async getAll(){const t={};for(const e of this.keyList)t[e]=await this.getItem(e);return t}async setAll(t){for(const e of Object.keys(t))await this.setItem(e,t[e])}}var d=a(13535),u=a(81273);let h;function v(t){h=t,u.log("To be removed when currentAccessToken is used",h)}const f={walletAddresses:"bank-visited-wallets",bankAddress:"bank-smart-contract-address",accountAddresses:"bank-account-addresses",registeredBankAddresses:"bank-linked-banks-registered",mainConfig:"application-configuration-variables"},p=new l(Object.values(f));function m(){return p}let w,g=!1,b=new(c()),y=new s.WalletCustodyApiImpl("http://pseudo","eth"),k=i().get("IOU"),A=k.at(""),_=i().get("CommercialBankCash"),C=i().get("BankAccount");async function I(t){w=t,u.log("Initializing api with variables",{...w});const e=new(c().providers.WebsocketProvider)(w.web3WebSocketUrl,{reconnect:{auto:!0,delay:400,onTimeout:!0}});b=new(c())(e),y=new s.WalletCustodyApiImpl(w.walletCustodyService,"eth"),A=k.at(w.IOUAddress),(0,d.Zm)(A.deployedAt,"IOU");const a=await b.eth.getChainId();u.log("Connected to chain",a),g=!0}function x(){if(!g)throw new Error("Use the initApis() function first")}function T(t,e,a=!1){x();let s=b;if(a){const t=new(c().providers.WebsocketProvider)(w.web3WebSocketUrl,{reconnect:{auto:!0,delay:400,onTimeout:!0}});s=new(c())(t)}if(!s.utils.isAddress(t))throw new Error("Provide a valid Ethereum address");if("function"!==typeof e)throw new Error("Expect an asynchronous function to ba called to authenticate the wallet");const r=new n.Web3CustodyFunctionProvider(s.currentProvider,y,t,e);return r}function B(){return x(),b.eth}function O(t){return x(),b.utils.toHex(t)}const S={from:t=>b.eth.Iban.toIban(t),to:t=>b.eth.Iban.toAddress(t)};function P(){return x(),A}function E(){return _}function W(){return C}async function F(t,e,a){try{t[e]=!0,await a()}finally{t[e]=!1}}},13535:function(t,e,a){"use strict";function s(t,e,a,s){return t+":"+String(e).padStart(8,"0")+String(a).padStart(3,"0")+String(s).padStart(3,"0")}a.d(e,{HJ:function(){return l},Uo:function(){return o},Zm:function(){return i}});const n=new Map;function r(t){return t?t.toLowerCase():t}function i(t,e){n.set(r(t),e)}function o(t,e){return"object"===typeof t&&void 0===e&&(e=t,t=void 0),c(t,e)}function c(t,e){if(!e.event)return;const a={...e.returnValues};for(const i of Object.keys(a))Number.isInteger(Number.parseInt(i))&&delete a[i],n.has(r(a[i]))&&(a[i]=n.get(r(a[i])));n.has(r(e.address))&&(e.address=n.get(r(e.address))||"undefined");const s=Object.keys(a).map((t=>`${t}:${a[t]}`)).join(", ");return`LOG: ${t?t+": ":""}${e.blockNumber}/${e.transactionIndex}/${e.logIndex} ${e.address}.${e.event}(${s})`}function l(t){return t?s("eth",t.blockNumber,t.transactionIndex,t.logIndex):""}i("0x0000000000000000000000000000000000000000","@Zero")},40876:function(t,e,a){"use strict";var s=a(27195),n=function(){var t=this,e=t._self._c;return e("v-app",{attrs:{id:"inspire"}},[e("wallet-password",{ref:"unique-wallet-password-id"}),e("snackbars",{ref:"snackbars"}),t.configurationOk?e("div",[e("app-menu"),e("v-main",[e("v-container",{staticClass:"py-8 px-6",attrs:{fluid:""}},["bank"==t.selectedItem?e("bank-page"):t._e(),"account"==t.selectedItem?e("accounts-page"):t._e(),"config"==t.selectedItem?e("configuration"):t._e(),"wallets"==t.selectedItem?e("wallets-page"):t._e(),"eventlog"==t.selectedItem?e("event-logs"):t._e()],1)],1)],1):e("div",[e("v-main",[e("v-container",{staticClass:"py-8 px-6",attrs:{fluid:""}},[e("configuration",{model:{value:t.configurationOk,callback:function(e){t.configurationOk=e},expression:"configurationOk"}})],1)],1)],1)],1)},r=[],i=function(){var t=this,e=t._self._c;return e("div",[e("v-btn",{directives:[{name:"show",rawName:"v-show",value:!t.drawer,expression:"!drawer"}],attrs:{fab:"",elevation:"3",top:"",left:""},on:{click:function(e){t.drawer=!t.drawer}}},[e("eth-avatar-icon",{attrs:{value:t.currentAddress}})],1),e("v-navigation-drawer",{attrs:{app:""},model:{value:t.drawer,callback:function(e){t.drawer=e},expression:"drawer"}},[e("wallet-custody-selection",{attrs:{value:t.activateWalletSelection}}),e("v-sheet",{staticClass:"pa-4",attrs:{color:"grey lighten-4"}},[e("v-avatar",{staticClass:"mb-4",attrs:{color:"grey darken-1",size:"64",rounded:""}},[e("eth-avatar-icon",{attrs:{value:t.currentAddress}})],1),t.currentAddress?e("div",[e("div",[t._v(t._s(t.currentAddress))]),e("div",[t._v(t._s(t.walletBalance/10**9)+" GWei")])]):e("div",[e("a",{on:{click:function(e){t.activateWalletSelection=!0}}},[t._v("Select a wallet")])])],1),e("v-divider"),e("v-list",[e("v-list-item-group",{attrs:{value:t.value,mandatory:"",color:"primary"},on:{change:function(e){return t.onChangeEvt(e)}}},t._l(t.links,(function([a,s,n]){return e("v-list-item",{key:a,attrs:{link:""}},["eventlog"==n&&t.evtCount>0?e("v-list-item-icon",[e("v-badge",{attrs:{content:t.evtCount,color:"primary"}},[e("v-icon",[t._v(t._s(a))])],1)],1):e("v-list-item-icon",[e("v-icon",[t._v(t._s(a))])],1),e("v-list-item-content",[e("v-list-item-title",[t._v(" "+t._s(s))])],1)],1)})),1)],1)],1)],1)},o=[],c=a(90408),l=a(68201),d=a(81771),u=a(98601),h=a(81273),v={components:{WalletCustodySelection:l["default"],EthAvatarIcon:d.Z},props:["value"],data:()=>({drawer:null,links:[["mdi-bank","Bank status","bank"],["mdi-account-cash","Client account","account"],["mdi-wallet","Wallets","wallets"],["mdi-radar","Confirmations","eventlog"],["mdi-cog","Configuration","config"]],activateWalletSelection:!1,walletBalance:""}),methods:{...(0,c.nv)(["goToPage"]),onChangeEvt(t){this.goToPage(this.links[t][2])},async getWalletBalance(){h.log("Getting wallet balance for ",this.currentAddress),this.currentAddress&&(this.walletBalance=await(0,u.tH)().getBalance(this.currentAddress))}},computed:{currentAddress(){return this.$store.getters.currentWalletAddress},evtCount(){return this.$store.getters.newEventsCount}},watch:{currentAddress(){this.getWalletBalance()}}},f=v,p=a(1001),m=(0,p.Z)(f,i,o,!1,null,null,null),w=m.exports,g=function(){var t=this,e=t._self._c;return e("v-container",[e("v-layout",{attrs:{row:"",wrap:""}},[e("v-row",[e("v-col",{attrs:{cols:"12"}},[e("h1",[t._v("Prepare the configuration")])]),t._l(t.asArrayOf,(function(a){return e("v-col",{key:a.name,attrs:{cols:"12"}},[e("v-card",{staticClass:"pa-4",attrs:{outlined:"",elevation:"3"}},[e("v-row",{staticClass:"align-center align-self-baseline"},[e("v-col",{attrs:{cols:"6",outlined:"",tile:""}},[e("v-text-field",{attrs:{label:a.name,"append-icon":"mdi-close",rules:[t.rules.notNull,a.valid]},on:{"click:append":function(e){t.variables[a.name]=""}},model:{value:t.variables[a.name],callback:function(e){t.$set(t.variables,a.name,e)},expression:"variables[v.name]"}})],1),e("v-col",{attrs:{cols:"6",outlined:"",tile:""}},[e("span",[t._v(t._s(a.desc))])])],1)],1)],1)}))],2),e("v-row",[e("v-col",{attrs:{cols:"1"}},[t.isConfigValid?e("v-icon",{attrs:{color:"green","x-large":""}},[t._v("mdi-thumb-up")]):e("v-icon",{attrs:{color:"red","x-large":""}},[t._v("mdi-thumb-down")])],1),e("v-col",{attrs:{cols:"11"}},[t.isConfigValid?e("v-btn",{attrs:{color:"primary"},on:{click:t.saveConfiguration}},[t._v("Save configuration")]):t._e()],1),e("v-col",{attrs:{cols:"2","align-self":"center"},on:{click:t.saveConfigToFile}},[e("v-btn",[t._v("Download config")])],1),e("v-col",{attrs:{cols:"4","align-self":"center"}},[e("v-file-input",{attrs:{"show-size":"",label:"place the file that contains the saved config"},model:{value:t.configFile,callback:function(e){t.configFile=e},expression:"configFile"}})],1),e("v-col",{attrs:{cols:"6","align-self":"center"},on:{click:t.loadConfigFromFile}},[e("v-btn",[t._v("Load config")])],1)],1)],1)],1)},b=[];function y(t,e){var a=document.createElement("a");a.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),a.setAttribute("download",t),a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a)}var k=a(81273);function A(t){if(!t)return!1;try{const e=new URL(t);return!!e}catch(e){return!1}}function _(t){return!!t&&("string"===typeof t&&(42===t.length&&t.startsWith("0x")))}const C=u.wp.mainConfig,I={IOUAddress:{typeof:"string",order:1,desc:"The address of the IOU smart contract in the blockchain",valid:t=>_(t)||"Enter an Ethereum address"},walletCustodyService:{typeof:"string",order:2,desc:"The url of the wallet custody service",valid:t=>A(t)||"Enter a valid url"},walletCustodyUI:{typeof:"string",order:3,desc:"The url of the wallet custody interface",valid:t=>A(t)||"Enter a valid url"},web3WebSocketUrl:{typeof:"string",order:4,desc:"The ws url of the web3 compatible node (typically infura url)",valid:t=>t&&A(t)||"Enter a valid websocket url"},blockchainExplorer:{typeof:"string",order:5,desc:"The blockchain explorer web site (typically etherscan). Should implements /tx/<tx>; /address/<address>; /token/<address>. Optional",valid:t=>!t||A(t)||"Optionally provide a valid url"}};var x={props:{value:Boolean},data:()=>({rules:{notNull:t=>void 0!==t&&null!==t||"Cannot accept null"},variables:{},saved:!1,configFile:void 0}),async mounted(){await this.getSourceOfVariables()},computed:{asArrayOf(){const t=Object.keys(I);return t.map((t=>({name:t,typeof:I[t].typeof,order:I[t].order,desc:I[t].desc,value:this.variables[t],valid:I[t].valid}))).sort(((t,e)=>t.order-e.order))},isConfigValid(){for(const t of this.asArrayOf)if(!0!==t.valid(t.value))return!1;return!0}},watch:{asArrayOf(){this.saved=!1},saved(){this.$emit("input",this.isConfigValid&&this.saved)},isConfigValid(){this.$emit("input",this.isConfigValid&&this.saved)}},methods:{...(0,c.nv)(["goToPage","applyVariables"]),async getSourceOfVariables(){let t,e=!1;const a=new URL(window.location);if(a.searchParams.has("config-url"))try{const e=new URL(a.searchParams.get("config-url")),s=await fetch(e.href),n=await s.json();a.searchParams.delete("config-url"),window.history.replaceState(null,"",a.href),n[C]?(t=n[C],delete n[C],await(0,u.tO)().setAll(n)):t=n}catch(n){k.warn("the config file is not usable",a.searchParams.get("config-url"),n)}if(!t)try{const a=await(0,u.tO)().getItem(C);if(!a)throw new Error("no configuration available in storage. key = "+C);e=!0,t=a}catch(n){k.warn("the config is not in storage",n.message)}t||(t={});const s=Object.keys(I);for(const r of Object.keys(t))s.includes(r)||delete t[r];for(const r of s)r in t||(t[r]="");this.variables=t,e&&await this.saveConfiguration()},async saveConfiguration(){try{await(0,u.tO)().setItem(C,this.variables),await this.applyVariables(this.variables),this.saved=!0}catch(t){k.error("Fail saving the configuration",t)}},async saveConfigToFile(){const t=await(0,u.tO)().getAll(),e=(location.origin+"_"+location.pathname).replace(/\//g,"_")+".json";y(e,JSON.stringify(t,null,2))},async loadConfigFromFile(){if(k.log("Config file",this.configFile),!this.configFile)return;let t=await this.configFile.text();t=JSON.parse(t),k.log("content loaded",t),await(0,u.tO)().setAll(t),await this.getSourceOfVariables(),window.location.reload()}}},T=x,B=(0,p.Z)(T,g,b,!1,null,null,null),O=B.exports,S=function(){var t=this,e=t._self._c;return e("v-container",[e("v-overlay",{attrs:{value:t.transactionInProgress}},[e("v-progress-circular",{attrs:{indeterminate:"",size:"64"}})],1),e("v-layout",{attrs:{row:"",wrap:""}},[e("v-row",[e("v-col",{attrs:{cols:"12"}},[e("h2",[t._v("This Bank : "+t._s(t.currency)+" ")]),t._v("with "+t._s(t.decimals)+" decimals ")]),t.bankInstance?e("v-col",{attrs:{cols:"12"}},[e("v-row",[e("v-col",{attrs:{cols:"12"}},[e("div",[t._v("Bank instance: "),e("expl-a",{attrs:{value:t.bankInstance.deployedAt,type:"token"}})],1),e("div",[t._v("Bank instance owner: "),e("expl-a",{attrs:{value:t.owner}})],1)]),e("v-col",{attrs:{cols:"12"}},[t._v(" Total commercial money supply in circulation: "),e("span",[t._v(t._s(t.formatting.format(t.totalSupply)))])]),e("v-col",{attrs:{cols:"12"}},[t._v(" Total debt against other banks: "),e("span",{class:t.globalDebt<0?"red--text":"green--text"},[t._v(t._s(t.formatting.format(t.globalDebt)))])])],1)],1):e("v-col",{attrs:{cols:"12"}},[e("div",[t._v("The instance of the bank does not exists or is unknown.")]),e("div",[t._v("If you have the address paste it here :")]),e("v-row",[e("v-col",{attrs:{cols:"11","align-self":"center"}},[e("v-text-field",{attrs:{label:"bank smart contract","append-icon":"mdi-close"},on:{"click:append":function(e){t.capturedBankAddress=""}},model:{value:t.capturedBankAddress,callback:function(e){t.capturedBankAddress=e},expression:"capturedBankAddress"}})],1),e("v-col",{attrs:{cols:"1","align-self":"center"}},[e("v-btn",{attrs:{color:"secondary",small:""},on:{click:function(e){return t.saveBankSmartContract(t.capturedBankAddress)}}},[t._v("Ok")])],1)],1),e("v-row",[e("v-col",{attrs:{cols:"6","align-self":"center"}},[t._v(" If you do not have a bank instance in the blockchain create it now ")]),e("v-col",{attrs:{cols:"6","align-self":"center"}},[e("v-btn",{attrs:{color:"primary",small:""},on:{click:t.createBankInstance}},[t._v("Create the bank")])],1)],1)],1),e("v-col",{attrs:{cols:"12"}},[e("v-row",[e("v-col",{attrs:{cols:"12"}},[e("h2",[t._v("List of registered banks")]),t._v("that you trust with debt you will accept on them")]),t._l(t.registeredBankDetails,(function(a){return e("v-col",{key:a.address,attrs:{cols:"12"}},[e("v-card",{staticClass:"pa-4",attrs:{outlined:"",elevation:"3"}},[e("v-card-title",[t._v("Bank  "),e("expl-a",{attrs:{value:a.address,type:"token"}})],1),e("div",[t._v("Owner: "),e("expl-a",{attrs:{value:a.owner}})],1),e("v-row",[e("v-col",{attrs:{cols:"6"}},[e("div",[t._v("Status: "+t._s(a.registered?"Registered":"Not registered"))]),e("div",[t._v("We owe them: "+t._s(t.formatting.format(a.debtFromUs)))]),e("div",[t._v("They owe us: "+t._s(t.formatting.format(a.debtToUs)))])]),a.debtToUs>0?e("v-col",{attrs:{cols:"6","align-self":"end"}},[e("v-btn",{on:{click:function(e){return t.confirmInterbankRepayment(a.address,a.debtToUs)}}},[t._v("Confirm you received the payment of "+t._s(t.formatting.format(a.debtToUs)))])],1):t._e()],1)],1)],1)})),e("v-col",{attrs:{cols:"12"}},[e("v-card",{staticClass:"pa-4",attrs:{outlined:"",elevation:"3"}},[e("v-card-title",[t._v("Register a new bank")]),e("v-row",[e("v-col",{attrs:{cols:"11","align-self":"center"}},[e("v-text-field",{attrs:{label:"bank smart contract address","append-icon":"mdi-close"},on:{"click:append":function(e){t.capturedBankAddress=""}},model:{value:t.capturedBankAddress,callback:function(e){t.capturedBankAddress=e},expression:"capturedBankAddress"}})],1),e("v-col",{attrs:{cols:"1","align-self":"center"}},[e("v-btn",{attrs:{color:"secondary",small:""},on:{click:function(e){return t.addRegisteredBank(t.capturedBankAddress)}}},[t._v("Ok")])],1)],1)],1)],1)],2)],1)],1)],1)],1)},P=[],E=(a(57658),a(82766)),W=function(){var t=this,e=t._self._c;return t.value?e("span",[t._t("default",(function(){return[t._v(t._s(t.value))]})),t.blockchainExplorer?e("v-icon",{staticClass:"pb-1",attrs:{small:"",color:"primary"},on:{click:t.openInNew}},[t._v("mdi-open-in-new")]):e("v-icon",{staticClass:"pb-1",attrs:{small:"",color:"red",title:"Define the blockchain explorer!"}},[t._v("mdi-open-in-new")])],2):t._e()},F=[],D={props:{value:String,type:String},computed:{blockchainExplorer(){return this.$store.getters.variables?.blockchainExplorer}},methods:{openInNew(){let t="address/";this.type?t=`${this.type}/`:this.value.length>42&&(t="tx/"),t+=this.value;const e=new URL(t,this.blockchainExplorer);window.open(e.href,"_blank")}}},$=D,U=(0,p.Z)($,W,F,!1,null,null,null),N=U.exports,R=a(81273);const G=u.wp.registeredBankAddresses;var z={components:{ExplA:N},data(){return{transactionInProgress:!1,walletBalance:"",currency:"",decimals:0,owner:"",capturedBankAddress:"",registeredBanks:[],registeredBankDetails:[],globalDebt:0,totalSupply:0,formatting:new Intl.NumberFormat("en",{minimumFractionDigits:2})}},async mounted(){await this.$nextTick(),this.registeredBanks=await(0,u.tO)().getItem(G)||[];try{await this.getBankCurrencyFromIOU(),await this.getIOUGlobalDebt(),await this.getBankDetails(),await this.getRegisteredBankDetails()}catch(t){R.error("Failed initializing",t)}this.formatting=new Intl.NumberFormat("en",{minimumFractionDigits:this.decimals,style:this.currency?"currency":void 0,currency:this.currency||void 0})},computed:{currentAddress(){return this.$store.getters.currentWalletAddress},bankInstance(){return this.$store.getters.bankSmartContract?(0,u.mm)().at(this.$store.getters.bankSmartContract):void 0}},watch:{async currentAddress(){await this.getWalletBalance()},bankInstance(t){t&&this.getIOUGlobalDebt()}},methods:{...(0,c.nv)(["authenticateWallet","saveBankSmartContract"]),async getWalletBalance(){R.log("Getting wallet balance for ",this.currentAddress),this.currentAddress&&(this.walletBalance=await(0,u.tH)().getBalance(this.currentAddress))},async getBankCurrencyFromIOU(){if(!this.currentAddress)return;const t=(0,u.bi)(this.currentAddress,E.up);this.currency=await(0,u.Yz)().symbol(t.call()),this.decimals=Number.parseInt(await(0,u.Yz)().decimals(t.call()))},async createBankInstance(){this.currentAddress&&(this.bankInstance||await(0,u.v1)(this,"transactionInProgress",(async()=>{const t=(0,u.bi)(this.currentAddress,E.up),e=await(0,u.mm)().deploy(t.newi({maxGas:3e6}),this.currency,this.decimals,(0,u.Yz)().deployedAt);await this.saveBankSmartContract(e.deployedAt),(0,E.t5)("The bank smart contract has beed created.")})))},async getBankDetails(){if(this.bankInstance&&this.currentAddress){const t=(0,u.bi)(this.currentAddress,E.up);this.owner=await this.bankInstance.owner(t.call()),this.totalSupply=Number.parseFloat(await this.bankInstance.totalSupply(t.call())),this.totalSupply=this.totalSupply/10**this.decimals,R.log("Bank owner",this.owner)}},async getIOUGlobalDebt(){if(this.bankInstance&&this.currentAddress){const t=(0,u.bi)(this.currentAddress,E.up),e=await(0,u.Yz)().balanceOf(t.call(),this.bankInstance.deployedAt),a=await(0,u.Yz)().balanceSignOf(t.call(),this.bankInstance.deployedAt);R.log("getIOUGlobalDebt",a,e),this.globalDebt=Number.parseInt(a)*Number.parseInt(e)/10**this.decimals}},async getRegisteredBankDetails(){if(this.bankInstance&&this.currentAddress){const t=(0,u.bi)(this.currentAddress,E.up),e=[];for(const a of this.registeredBanks){const s={address:a},n=(0,u.mm)().at(a);s.owner=await n.owner(t.call()),s.registered=await this.bankInstance.isBankRegistered(t.call(),a),s.debtFromUs=Number.parseFloat(await(0,u.Yz)().bankOwesTo(t.call(),this.bankInstance.deployedAt,a)),s.debtToUs=Number.parseFloat(await(0,u.Yz)().bankOwesTo(t.call(),a,this.bankInstance.deployedAt)),s.debtFromUs=s.debtFromUs/10**this.decimals,s.debtToUs=s.debtToUs/10**this.decimals,e.push(s)}this.registeredBankDetails=e}},async addRegisteredBank(t){this.bankInstance&&this.currentAddress&&await(0,u.v1)(this,"transactionInProgress",(async()=>{const e=(0,u.bi)(this.currentAddress,E.up),a=await(0,u.mm)().at(t).owner(e.call());if(!a)throw new Error("The address of the smart contract is not a valid bank address");await this.bankInstance.registerBank(e.send({maxGas:1e5}),t),this.registeredBanks.push(t),await(0,u.tO)().setItem(G,this.registeredBanks),await this.getRegisteredBankDetails(),(0,E.t5)("The external bank has been registered."),this.capturedBankAddress=void 0}))},async confirmInterbankRepayment(t,e){this.bankInstance&&this.currentAddress&&await(0,u.v1)(this,"transactionInProgress",(async()=>{const a=(0,u.bi)(this.currentAddress,E.up);await this.bankInstance.confirmInterbankPayment(a.send({maxGas:1e5}),t,e*10**this.decimals),(0,E.t5)(`The debt of ${e} ${this.currency} has been cleared.`),await this.getRegisteredBankDetails(),await this.getIOUGlobalDebt()}))}}},Z=z,L=(0,p.Z)(Z,S,P,!1,null,null,null),j=L.exports,V=function(){var t=this,e=t._self._c;return e("v-container",[e("v-overlay",{attrs:{value:t.transactionInProgress}},[e("v-progress-circular",{attrs:{indeterminate:"",size:"64"}})],1),e("v-layout",{attrs:{row:"",wrap:""}},[e("v-row",[e("v-col",{attrs:{cols:"12"}},[e("v-card",{staticClass:"pa-3",attrs:{outlined:"",elevation:"3"}},[e("v-row",[e("v-col",{attrs:{cols:"3","align-self":"center"}},[e("v-btn",{attrs:{color:"primary"},on:{click:t.createNewAccount}},[t._v("Create new account")])],1),e("v-col",{attrs:{cols:"9","align-self":"center"}},[e("v-text-field",{attrs:{label:"New account name",counter:""},model:{value:t.newAccountName,callback:function(e){t.newAccountName=e},expression:"newAccountName"}})],1)],1)],1)],1),t._l(t.accounts,(function(a){return e("v-col",{key:a.address,attrs:{cols:"12"}},[e("v-card",{staticClass:"pa-3",attrs:{elevation:t.selectedAccount==a.address?"12":"2",outlined:t.selectedAccount==a.address},on:{click:function(e){t.selectedAccount=a.address}}},[e("v-row",[e("v-col",{attrs:{cols:"2","align-self":"center"}},[e("div",[t._v(t._s(a.name))]),e("div",[t._v(t._s(t.formatting.format(a.balance)))])]),e("v-col",{attrs:{cols:"5","align-self":"center"}},[t.selectedAccount==a.address?e("div",[e("v-text-field",{attrs:{label:"amount",type:"number"},model:{value:t.changeBalanceAmount,callback:function(e){t.changeBalanceAmount=e},expression:"changeBalanceAmount"}}),t.showTransfer?t._e():e("v-btn",{on:{click:function(e){return t.changeBalance(1)}}},[t._v("credit")]),t.showTransfer?t._e():e("v-btn",{on:{click:function(e){return t.changeBalance(-1)}}},[t._v("debit")]),t.showTransfer?t._e():e("v-btn",{on:{click:function(e){t.showTransfer=!0}}},[t._v("Transfer ...")]),t.showTransfer?e("v-text-field",{attrs:{label:"target account address",type:"text"},model:{value:t.transferToAddress,callback:function(e){t.transferToAddress=e},expression:"transferToAddress"}}):t._e(),t.showTransfer?e("v-btn",{on:{click:function(e){t.showTransfer=!1}}},[t._v("Cancel")]):t._e(),t.showTransfer?e("v-btn",{on:{click:t.executeTransfer}},[t._v("Ok")]):t._e()],1):t._e()]),e("v-col",{attrs:{cols:"5","align-self":"center"}},[e("div",[t._v("address: "),e("expl-a",{attrs:{value:a.address,type:"token"}})],1),e("div",[t._v("IBAN: "+t._s(a.iban))]),e("div",[t._v("owner: "),e("expl-a",{attrs:{value:a.owner}})],1),t.selectedAccount==a.address?e("v-row",[e("v-col",{attrs:{cols:"9","align-self":"center"}},[e("v-text-field",{attrs:{messages:"Whitelist a wallet to grant access",label:"grant access to",type:"text"},model:{value:t.whitelistedAddress,callback:function(e){t.whitelistedAddress=e},expression:"whitelistedAddress"}})],1),e("v-col",{attrs:{cols:"3","align-self":"center"}},[e("v-btn",{on:{click:t.whitelistAddress}},[t._v("Ok")])],1)],1):t._e()],1)],1)],1)],1)}))],2)],1),e("div",{staticClass:"mt-8"},[t._v("*) Note on Iban: XE country code is not widely recognized by the banking community. Alternative encoding may be needed, such as having the bank smart contract provide a 2 letter prefix instead")])],1)},Y=[],M=a(13535),H=a(81273);const J=u.wp.accountAddresses;var q={components:{ExplA:N},data(){return{transactionInProgress:!1,currency:"",decimals:0,accountAddresses:[],accounts:[],newAccountName:"",selectedAccount:"",changeBalanceAmount:null,formatting:new Intl.NumberFormat("en",{minimumFractionDigits:2}),showTransfer:!1,transferToAddress:void 0,whitelistedAddress:void 0}},async mounted(){const t=await(0,u.tO)().getItem(J);t&&Array.isArray(t)&&(this.accountAddresses=t,this.accounts=t.filter((t=>!!t)).map((t=>({address:t,name:"",balance:void 0,owner:void 0,iban:void 0}))),await this.getCurrency(),this.formatting=new Intl.NumberFormat("en",{minimumFractionDigits:this.decimals,style:this.currency?"currency":void 0,currency:this.currency||void 0}),this.fillAccounts())},computed:{currentAddress(){return this.$store.getters.currentWalletAddress},bankInstance(){return this.$store.getters.bankSmartContract?(0,u.mm)().at(this.$store.getters.bankSmartContract):void 0}},methods:{async getCurrency(){if(!this.currentAddress||!this.bankInstance)return;const t=(0,u.bi)(this.currentAddress,E.up);this.currency=await this.bankInstance.symbol(t.call()),this.decimals=Number.parseInt(await this.bankInstance.decimals(t.call())),H.log("Currency: ",this.currency,this.decimals)},async saveAddresses(){await(0,u.tO)().setItem(J,this.accountAddresses)},async fillAccounts(t){if(!this.currentAddress)return;const e=(0,u.bi)(this.currentAddress,E.up),a=t?[t]:this.accountAddresses,s=[];for(const n of this.accountAddresses)if(a.includes(n)){const t={address:n},a=(0,u.nY)().at(t.address);t.name=await a.getAttributeStr(e.call(),(0,u.NC)("name")),H.log("Actual balance value",await a.balance(e.call())),t.balance=Number.parseFloat(await a.balance(e.call()))/10**this.decimals,t.owner=await a.owner(e.call()),t.iban=u.U6.from(t.address),(0,M.Zm)(t.address,t.name),s.push(t)}else s.push(this.accounts.find((t=>t.address===n)));this.accounts=s},async createNewAccount(){this.currentAddress&&this.bankInstance&&this.newAccountName&&await(0,u.v1)(this,"transactionInProgress",(async()=>{const t=(0,u.bi)(this.currentAddress,E.up),e=await(0,u.nY)().deploy(t.newi({maxGas:12e5}),this.newAccountName);await e.transferOwnership(t.send({maxGas:5e4}),this.bankInstance.deployedAt),await this.bankInstance.registerAccount(t.send({maxGas:1e5}),e.deployedAt),(0,E.t5)("New account created."),this.accountAddresses=[...this.accountAddresses,e.deployedAt],await this.saveAddresses(),await this.fillAccounts(e.deployedAt)}))},async changeBalance(t){this.currentAddress&&this.bankInstance&&this.selectedAccount&&this.changeBalanceAmount&&await(0,u.v1)(this,"transactionInProgress",(async()=>{const e=(0,u.bi)(this.currentAddress,E.up),a=Math.round(this.changeBalanceAmount*10**this.decimals);t>0?(await this.bankInstance.credit(e.send({maxGas:1e5}),this.selectedAccount,a),(0,E.t5)(`Account credited with ${this.changeBalanceAmount} ${this.currency}`)):(await this.bankInstance.debit(e.send({maxGas:1e5}),this.selectedAccount,a),(0,E.t5)(`Account debited with ${this.changeBalanceAmount} ${this.currency}`)),this.changeBalanceAmount=void 0,await this.fillAccounts(this.selectedAccount)}))},async executeTransfer(){this.currentAddress&&this.bankInstance&&this.selectedAccount&&this.changeBalanceAmount&&this.transferToAddress&&await(0,u.v1)(this,"transactionInProgress",(async()=>{const t=(0,u.bi)(this.currentAddress,E.up),e=Math.round(this.changeBalanceAmount*10**this.decimals),a=(0,u.nY)().at(this.selectedAccount);await a.transfer(t.send({maxGas:3e5}),this.transferToAddress,e),(0,E.t5)(`Transfer ${this.changeBalanceAmount} ${this.currency} to account.`),await this.fillAccounts(this.selectedAccount),await this.fillAccounts(this.transferToAddress),this.changeBalanceAmount=void 0,this.transferToAddress=void 0}))},async whitelistAddress(){this.currentAddress&&this.selectedAccount&&this.whitelistedAddress&&await(0,u.v1)(this,"transactionInProgress",(async()=>{const t=(0,u.bi)(this.currentAddress,E.up),e=(0,u.nY)().at(this.selectedAccount);await e.whitelist(t.send({maxGas:5e4}),this.whitelistedAddress),(0,E.t5)("Wallet whitelisted for the account."),this.whitelistedAddress=void 0}))}}},X=q,K=(0,p.Z)(X,V,Y,!1,null,null,null),Q=K.exports,tt=function(){var t=this,e=t._self._c;return e("v-dialog",{attrs:{persistent:"","max-width":"650px"},model:{value:t.displayAuthenticationDialog,callback:function(e){t.displayAuthenticationDialog=e},expression:"displayAuthenticationDialog"}},[e("v-card",[e("v-card-title",[e("v-row",[e("v-col",{attrs:{cols:"2","align-self":"center"}},[e("eth-avatar-icon",{attrs:{value:t.walletAddress}})],1),e("v-col",{attrs:{cols:"10","align-self":"center"}},[e("div",{staticClass:"text-h5"},[t._v("Sign transaction with")]),e("div",{staticClass:"text-h6"},[t._v(t._s(t.walletAddress))])])],1)],1),e("v-card-text",[e("v-container",[e("v-row",[e("v-col",[e("v-text-field",{attrs:{"append-icon":t.showPassword?"mdi-eye":"mdi-eye-off",type:t.showPassword?"text":"password",name:"password",label:"Enter the wallet password",counter:"",autofocus:""},on:{"click:append":function(e){t.showPassword=!t.showPassword}},model:{value:t.password,callback:function(e){t.password=e},expression:"password"}})],1)],1),t.authenticationError?e("v-row",[e("v-col",[e("span",{staticClass:"red--text text-h6"},[t._v(t._s(t.authenticationError))])])],1):t._e()],1)],1),e("v-card-actions",[e("v-checkbox",{attrs:{label:"Remember my password for the session"},model:{value:t.rememberPassword,callback:function(e){t.rememberPassword=e},expression:"rememberPassword"}}),e("v-spacer"),e("v-btn",{ref:"close",attrs:{color:"blue darken-1",text:""},on:{click:function(e){return t.closeAuthenticationDialog()}}},[t._v(" Close ")]),e("v-btn",{ref:"verify",attrs:{color:"primary darken-1",text:""},on:{click:function(e){return t.verifyAuthentication()}}},[t._v(" Verify ")])],1)],1)],1)},et=[],at={components:{EthAvatarIcon:d.Z},data(){return{password:void 0,walletAddress:void 0,displayAuthenticationDialog:!1,showPassword:!1,authenticationError:void 0,rememberPassword:!1}},methods:{async closeAuthenticationDialog(){},async verifyAuthentication(){},async showDialog(t,e){if(this.displayAuthenticationDialog&&this.walletAddress!==t)throw new Error("The dialog cannot be used twice with 2 different addresses at the same time");this.displayAuthenticationDialog||(this.displayAuthenticationDialog=!0,this.authenticationError=e,this.walletAddress=t),await this.$nextTick();const a=await new Promise((e=>{this.$refs.verify.$once("click",(()=>{e({address:t,password:this.password,keepPassword:this.rememberPassword,ok:!0})})),this.$refs.close.$once("click",(()=>{e({address:t,ok:!1})}))}));return this.displayAuthenticationDialog=!1,this.password=void 0,this.authenticationError=void 0,this.walletAddress=void 0,a}}},st=at,nt=(0,p.Z)(st,tt,et,!1,null,null,null),rt=nt.exports,it=a(7160),ot=function(){var t=this,e=t._self._c;return e("v-container",[e("v-layout",{attrs:{row:"",wrap:""}},[e("v-simple-table",{attrs:{"fixed-header":""},scopedSlots:t._u([{key:"default",fn:function(){return[e("thead",[e("tr",[e("th",{staticClass:"text-left text-h6"},[t._v("LOG: block/tx/index Initiator.Event(param1, param2, param3, ...)")])])]),e("tbody",t._l(t.eventsSorted,(function(a){return e("tr",{key:a.id,staticClass:"pt-6"},[e("td",[e("div",[t._v(t._s(a.formatted)+" ")]),e("div",{staticClass:"text--secondary text-body-2"},[t._v("Tx: "),e("expl-a",{attrs:{value:a.transactionHash}})],1)])])})),0)]},proxy:!0}])})],1)],1)},ct=[],lt={components:{ExplA:N},data(){return{}},mounted(){this.resetEventsCount()},computed:{eventsSorted(){return this.$store.getters.events.map((t=>({...t,formatted:(0,M.Uo)(t),sortableId:(0,M.HJ)(t)}))).sort(((t,e)=>-t.sortableId.localeCompare(e.sortableId)))}},methods:{...(0,c.nv)(["resetEventsCount"])}},dt=lt,ut=(0,p.Z)(dt,ot,ct,!1,null,null,null),ht=ut.exports,vt=function(){var t=this,e=t._self._c;return e("div",t._l(t.bars,(function(a){return e("v-snackbar",{key:a.id,ref:"bar-"+a.id,refInFor:!0,style:"top:"+a.top+"px",attrs:{app:"",top:"",right:"",timeout:a.timeout,color:a.color,"max-width":"150"},on:{input:function(e){return t.closingBar(a)}},model:{value:a.visible,callback:function(e){t.$set(a,"visible",e)},expression:"bar.visible"}},[e("v-icon",{staticClass:"pr-2"},[t._v(t._s(a.icon||"mdi-check-outline"))]),t._v(" "+t._s(a.text)+" ")],1)})),1)},ft=[],pt={data(){return{lastId:-1,bars:[]}},mounted(){},methods:{closingBar(){this.recalculateBars()},recalculateBars(){let t=this.bars.map((t=>({...t})));t=t.filter((t=>t.visible));let e=0;for(const a of t){a.top=e;const t=this.$refs[`bar-${a.id}`];if(Array.isArray(t)&&1===t.length&&t[0].$el.firstElementChild){const a=t[0].$el.firstElementChild;e+=a.offsetHeight+10}}this.bars=t},addBar(t){t={id:this.lastId++,visible:!0,timeout:1e4,...t},this.bars.push(t),this.recalculateBars()},addError(t,e={}){const a={color:"red",icon:"mdi-message-alert-outline",...e};a.text=t,this.addBar(a)},addConfirm(t,e={}){const a={color:"green",icon:"mdi-check-outline",...e};a.text=t,this.addBar(a)}}},mt=pt,wt=(0,p.Z)(mt,vt,ft,!1,null,null,null),gt=wt.exports,bt=a(81273),yt={components:{AppMenu:w,Configuration:O,BankPage:j,AccountsPage:Q,EventLogs:ht,WalletsPage:it.ZP,WalletPassword:rt,Snackbars:gt},data:()=>({configurationOk:!1,pollingInError:!1,lastErrorMessage:""}),computed:{selectedItem(){return this.$store.getters.activePage},loggedIn(){return!0},initializationReady(){const t=!!this.$store.getters.bankSmartContract,e=!!this.$store.getters.variables.IOUAddress;return e&&t}},watch:{initializationReady(t,e){bt.log("watched initializationReady",t,e),(0,M.Zm)(this.$store.getters.bankSmartContract,"ThisBank"),this.collectBankEvents({subscribe:!0,fromBlock:0})}},methods:{...(0,c.nv)(["loadData","refreshAccessToken","applyWalletPasswordDialog","applySnackbars","collectBankEvents"])},async mounted(){bt.log("applyWalletPasswordDialog",this.$refs["unique-wallet-password-id"]),await this.applyWalletPasswordDialog(this.$refs["unique-wallet-password-id"]),await this.applySnackbars(this.$refs["snackbars"])},errorCaptured(t){return(0,E.cB)(t.message||t),!1}},kt=yt,At=(0,p.Z)(kt,n,r,!1,null,null,null),_t=At.exports,Ct=a(86017),It=a.n(Ct);a(8556);s["default"].use(It());var xt=new(It())({theme:{themes:{light:{primary:"#007BFF",secondary:"#424242",accent:"#82B1FF",error:"#FF5252",info:"#2196F3",success:"#4CAF50",warning:"#FFC107"}}}});s["default"].config.productionTip=!1,new s["default"]({vuetify:xt,store:E.ZP,render:t=>t(_t)}).$mount("#app")},82766:function(t,e,a){"use strict";a.d(e,{ZP:function(){return h},cB:function(){return p},t5:function(){return m},up:function(){return f}});a(57658);var s=a(27195),n=a(90408),r=a(98601);const i="bf96b738-483a-4b00-8147-5bad2acf06ac";async function o(t){var e=new URLSearchParams;e.append("grant_type","refresh_token"),e.append("refresh_token",t),e.append("client_id",i),e.append("scope","broker.read openid");var a=new Headers;a.append("Content-Type","application/x-www-form-urlencoded");var s={method:"POST",headers:a,body:e,redirect:"follow"};const n=await fetch("https://trusstee.io/broker/token",s);if(n.ok)return await n.json();throw new Error("Fail refreshing token "+n.statusText)}async function c(t){if(!window.Trusstee)throw new Error("Trusstee script not initialized");const e=await window.Trusstee.createConfiguration({issuer:"https://trusstee.io/broker",client_id:i,idp_hint:t}),a=await window.Trusstee.silentOIDCLogin.promise(e);return a}async function l(t){if(!window.Trusstee)throw new Error("Trusstee script not initialized");const e=await window.Trusstee.createConfiguration({issuer:"https://trusstee.io/broker",client_id:i,idp_hint:t}),a=await window.Trusstee.popupOIDCLogin.promise(e);return a}var d=a(81273);s["default"].use(n.ZP);const u=new n.ZP.Store({state:{userIdentity:null,serviceToken:"service-token",oauth2Tokens:null,tokenRefreshTimer:null,activePage:"",walletPasswordDialog:void 0,snackbars:void 0,variables:{},currentWalletAddress:null,bankSmartContract:void 0,bankEventsCollectedFor:void 0,events:[],newEventsCount:0},mutations:{setUserIdentity(t,e){t.userIdentity=e},setActivePage(t,e){t.activePage=e},setOauth2Tokens(t,e){t.serviceToken=e.access_token,t.oauth2Tokens=e},setTokenRefreshTimer(t,e){t.tokenRefreshTimer&&clearTimeout(t.tokenRefreshTimer),t.tokenRefreshTimer=e},setVariables(t,e){t.variables=e},setCurrentWalletAddress(t,e){t.currentWalletAddress=e},setWalletPasswordDialog(t,e){t.walletPasswordDialog=e},setSnackbar(t,e){"addError"in e&&"addConfirm"in e&&(t.snackbars=e)},setBankSmartContract(t,e){t.bankSmartContract=e},setBankEventsCollectedFor(t,e){t.bankEventsCollectedFor=e},addEvent(t,e){if(e.error)t.events.push(e);else{const a=t.events.find((t=>t.blockNumber==e.blockNumber&&t.transactionIndex==e.transactionIndex&&t.logIndex==e.logIndex));a||(t.events.push(e),t.newEventsCount=t.newEventsCount+1)}},setEventsCount(t,e){t.newEventsCount=e}},actions:{async applyUserIdentity({commit:t},e){t("setUserIdentity",e)},async applyUserOauth2Tokens({commit:t,dispatch:e},a){(0,r.M8)(a.access_token),t("setOauth2Tokens",a);const s=setTimeout((async()=>{await e("refreshAccessToken")}),1e3*(a.expires_in-10));t("setTokenRefreshTimer",s)},async refreshAccessToken({state:t,dispatch:e},a=!0){const s=t.oauth2Tokens;if(!s)return;const n=s.refresh_token;if(!n)return;let r;try{r=await o(n),d.log("Token refreshed",r)}catch(i){d.warn("Fail refreshing the authentication. Trying iframe silent login",i);try{r=await c(s.origin_issuer),d.log("Token re login",r)}catch(i){d.warn("Fail silently updating the authentication. Trying popup login",i);try{r=await l(s.origin_issuer),d.log("Token popup login",r)}catch(i){d.error("Fail updating the authentication in a popup",i)}}}if(r)r.refresh_token=n,await e("applyUserOauth2Tokens",r);else{if(!a)throw new Error("Fail to connect to the IDP");window.location=window.location.href}},async goToPage({commit:t,state:e},a){e.activePage!==a&&t("setActivePage",a)},async applyVariables({commit:t},e){await(0,r.Y2)(e),t("setVariables",e)},async applyCurrentWalletAddress({commit:t},e){t("setCurrentWalletAddress",e)},async applyWalletPasswordDialog({commit:t},e){t("setWalletPasswordDialog",e)},async applySnackbars({commit:t},e){t("setSnackbar",e)},async authenticateWallet({state:t},{api:e,address:a}){const s=t.walletPasswordDialog;if(!s)throw new Error("Ensure the <wallet-password> element is configured ");let n,r,i={address:a,ok:!0,password:void 0,keepPassword:!1};i.password=window.sessionStorage.getItem("pwd-"+a);while(!n){if(i.password||(i=await s.showDialog(a,r)),d.log("returned",a,i,n,r),!i.ok)return;try{n=await e.authenticate(a,i.password),i.keepPassword&&window.sessionStorage.setItem("pwd-"+a,i.password)}catch(o){i.password=void 0,d.log("failed",o),r=o.message}}return d.log("Returning token",n),n},async intitializeFromStorage({commit:t}){const e=await(0,r.tO)().getItem(r.wp.bankAddress);t("setBankSmartContract",e)},async saveBankSmartContract({commit:t},e){t("setBankSmartContract",e),await(0,r.tO)().setItem(r.wp.bankAddress,e)},async collectBankEvents({commit:t,state:e},{subscribe:a,fromBlock:s}){if(e.bankEventsCollectedFor&&e.bankEventsCollectedFor.address==e.bankSmartContract)return;d.log("ready so subscribe",a,s);const n=(0,r.mm)().at(e.bankSmartContract),i=(0,r.bi)(e.bankSmartContract,(()=>Promise.resolve("")),!0),o=a?i.sub({fromBlock:s}):i.get({fromBlock:s}),c=n.allEvents(o);c.on("log",(e=>{t("addEvent",e)})),c.on("error",(e=>t("addEvent",{error:e})));const l=(0,r.Yz)().allEvents(o);l.on("log",(e=>{t("addEvent",e)})),l.on("error",(e=>t("addEvent",{error:e}))),t("setBankEventsCollectedFor",{address:e.bankSmartContract,bankReceiver:c,iouReceiver:l})},async resetEventsCount({commit:t}){t("setEventsCount",0)}},getters:{activePage(t){return t.activePage},userIdentity(t){return t.userIdentity?{email:t.userIdentity.email,name:t.userIdentity.name}:{email:"",name:""}},userAccessToken(t){return t.serviceToken},authenticated(t){return!!t.oauth2Tokens},variables(t){return{...t.variables}},currentWalletAddress(t){return t.currentWalletAddress},displayWalletPasswordDialog(t){return t.displayWalletPasswordDialog},bankSmartContract(t){return t.bankSmartContract},events(t){return t.events},newEventsCount(t){return t.newEventsCount}}});var h=u;async function v(){await u.dispatch("intitializeFromStorage")}async function f(t,e){return await u.dispatch("authenticateWallet",{api:e,address:t})}function p(t){u.state.snackbars.addError(t)}function m(t){u.state.snackbars.addConfirm(t)}v()},46601:function(){},89214:function(){},85568:function(){},52361:function(){},94616:function(){},72357:function(){},26751:function(){},15820:function(){},47562:function(){},70047:function(){},30128:function(){},55914:function(){},83814:function(){},75662:function(){},33122:function(){}},e={};function a(s){var n=e[s];if(void 0!==n)return n.exports;var r=e[s]={id:s,loaded:!1,exports:{}};return t[s].call(r.exports,r,r.exports,a),r.loaded=!0,r.exports}a.m=t,function(){a.amdO={}}(),function(){var t=[];a.O=function(e,s,n,r){if(!s){var i=1/0;for(d=0;d<t.length;d++){s=t[d][0],n=t[d][1],r=t[d][2];for(var o=!0,c=0;c<s.length;c++)(!1&r||i>=r)&&Object.keys(a.O).every((function(t){return a.O[t](s[c])}))?s.splice(c--,1):(o=!1,r<i&&(i=r));if(o){t.splice(d--,1);var l=n();void 0!==l&&(e=l)}}return e}r=r||0;for(var d=t.length;d>0&&t[d-1][2]>r;d--)t[d]=t[d-1];t[d]=[s,n,r]}}(),function(){a.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return a.d(e,{a:e}),e}}(),function(){a.d=function(t,e){for(var s in e)a.o(e,s)&&!a.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){a.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){a.nmd=function(t){return t.paths=[],t.children||(t.children=[]),t}}(),function(){var t={143:0};a.O.j=function(e){return 0===t[e]};var e=function(e,s){var n,r,i=s[0],o=s[1],c=s[2],l=0;if(i.some((function(e){return 0!==t[e]}))){for(n in o)a.o(o,n)&&(a.m[n]=o[n]);if(c)var d=c(a)}for(e&&e(s);l<i.length;l++)r=i[l],a.o(t,r)&&t[r]&&t[r][0](),t[r]=0;return a.O(d)},s=self["webpackChunkfront"]=self["webpackChunkfront"]||[];s.forEach(e.bind(null,0)),s.push=e.bind(null,s.push.bind(s))}();var s=a.O(void 0,[998],(function(){return a(40876)}));s=a.O(s)})();
//# sourceMappingURL=app.f047ba4c.js.map